<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Cherry Collector</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(to bottom, #87CEEB 0%, #E0F6FF 100%);
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        #gameContainer {
            text-align: center;
            max-width: 100%;
            padding: 10px;
        }
        
        canvas {
            border: 4px solid #8B4513;
            border-radius: 8px;
            background: linear-gradient(to bottom, #87CEEB 0%, #90EE90 70%, #8B7355 70%, #654321 100%);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
            touch-action: none;
            max-width: 100%;
            height: auto;
        }
        
        #score {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8);
        }
        
        #instructions {
            margin-top: 10px;
            color: #333;
            font-size: 14px;
        }
        
        #timer {
            font-size: 18px;
            color: #d32f2f;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        #animalSelector {
            margin-top: 10px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            display: none;
        }
        
        .animalButton {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            border: 2px solid #333;
            border-radius: 5px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .animalButton:hover {
            background: #f0f0f0;
            transform: scale(1.05);
        }
        
        .animalButton.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .animalButton.selected {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        
        #gameOver {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            z-index: 1000;
        }
        
        #gameOver h2 {
            font-size: 48px;
            margin: 0 0 20px 0;
            color: #ff4444;
        }
        
        #gameOver button {
            padding: 15px 30px;
            font-size: 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
        }
        
        #gameOver button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="timer">Time until Game Over: 12.0s</div>
        <div id="score">Cherries: 0 | Size: 1.0x | Next Unlock: 10.0x</div>
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div id="instructions">Use ‚Üê ‚Üí Arrow Keys or Swipe to Move | Collect 5 cherries every 12 seconds to survive! | Reach 10.0x to unlock new animals!</div>
        <div id="animalSelector">
            <h3>Select Your Animal (Game will restart!):</h3>
            <button class="animalButton selected" data-animal="whale">üêã Whale</button>
            <button class="animalButton locked" data-animal="elephant">üêò Elephant (Unlock at 10.0x)</button>
            <button class="animalButton locked" data-animal="bear">üêª Bear (Unlock at 20.0x)</button>
            <button class="animalButton locked" data-animal="lion">ü¶Å Lion (Unlock at 30.0x)</button>
            <button class="animalButton locked" data-animal="panda">üêº Panda (Unlock at 40.0x)</button>
        </div>
    </div>
    
    <div id="gameOver">
        <h2>GAME OVER!</h2>
        <p id="finalScore"></p>
        <button onclick="restartGame()">Play Again</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Game state
        const game = {
            score: 0,
            cherries: [],
            player: {
                x: 400,
                y: 490,
                baseSize: 30,
                size: 30,
                speed: 5,
                scale: 1.0
            },
            keys: {},
            platformY: 520,
            cherrySpawnTimer: 0,
            cherrySpawnInterval: 60,
            timer: 12.0,
            cherriesSinceReset: 0,
            currentAnimal: 'whale',
            unlockedAnimals: ['whale'],
            isGameOver: false,
            highestSizeReached: 1.0,
            nextUnlockSize: 10.0
        };
        
        // Cherry class
        class Cherry {
            constructor() {
                this.x = Math.random() * (canvas.width - 40) + 20;
                this.y = -20;
                this.size = 15;
                this.speed = 2 + Math.random() * 2;
            }
            
            update() {
                this.y += this.speed;
            }
            
            draw() {
                // Cherry body
                ctx.fillStyle = '#DC143C';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Highlight
                ctx.fillStyle = 'rgba(255, 100, 100, 0.6)';
                ctx.beginPath();
                ctx.arc(this.x - 4, this.y - 4, 5, 0, Math.PI * 2);
                ctx.fill();
                
                // Stem
                ctx.strokeStyle = '#228B22';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(this.x, this.y - this.size);
                ctx.quadraticCurveTo(this.x + 5, this.y - this.size - 10, this.x + 8, this.y - this.size - 15);
                ctx.stroke();
                
                // Leaf
                ctx.fillStyle = '#32CD32';
                ctx.beginPath();
                ctx.ellipse(this.x + 8, this.y - this.size - 12, 6, 4, Math.PI / 4, 0, Math.PI * 2);
                ctx.fill();
            }
            
            isOffScreen() {
                return this.y > canvas.height + 20;
            }
            
            collidesWith(player) {
                const dx = this.x - player.x;
                const dy = this.y - player.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                return distance < this.size + player.size;
            }
        }
        
        // Draw player (multiple animals)
        function drawPlayer() {
            const p = game.player;
            
            switch(game.currentAnimal) {
                case 'whale':
                    drawWhale(p);
                    break;
                case 'elephant':
                    drawElephant(p);
                    break;
                case 'bear':
                    drawBear(p);
                    break;
                case 'lion':
                    drawLion(p);
                    break;
                case 'panda':
                    drawPanda(p);
                    break;
            }
        }
        
        function drawWhale(p) {
            // Whale body (main oval)
            ctx.fillStyle = '#4682B4';
            ctx.beginPath();
            ctx.ellipse(p.x, p.y, p.size * 1.2, p.size * 0.8, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Belly (lighter blue)
            ctx.fillStyle = '#87CEEB';
            ctx.beginPath();
            ctx.ellipse(p.x, p.y + p.size * 0.2, p.size * 0.9, p.size * 0.5, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Tail
            ctx.fillStyle = '#4682B4';
            ctx.beginPath();
            ctx.moveTo(p.x + p.size * 1.2, p.y);
            ctx.lineTo(p.x + p.size * 1.5, p.y - p.size * 0.4);
            ctx.lineTo(p.x + p.size * 1.6, p.y);
            ctx.lineTo(p.x + p.size * 1.5, p.y + p.size * 0.4);
            ctx.closePath();
            ctx.fill();
            
            // Eye
            const eyeOffset = p.size * 0.5;
            const eyeSize = p.size * 0.12;
            
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc(p.x - eyeOffset, p.y - p.size * 0.2, eyeSize, 0, Math.PI * 2);
            ctx.fill();
            
            // Eye highlight
            ctx.fillStyle = '#FFF';
            ctx.beginPath();
            ctx.arc(p.x - eyeOffset + eyeSize * 0.3, p.y - p.size * 0.2 - eyeSize * 0.3, eyeSize * 0.4, 0, Math.PI * 2);
            ctx.fill();
            
            // Water spout
            if (Math.random() > 0.9) {
                ctx.fillStyle = '#ADD8E6';
                ctx.beginPath();
                ctx.arc(p.x - p.size * 0.8, p.y - p.size * 0.6, p.size * 0.15, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(p.x - p.size * 0.7, p.y - p.size * 0.9, p.size * 0.1, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Mouth (smile)
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.7, p.y + p.size * 0.1, p.size * 0.3, 0.2, Math.PI - 0.2);
            ctx.stroke();
        }
        
        function drawElephant(p) {
            // Body
            ctx.fillStyle = '#A9A9A9';
            ctx.beginPath();
            ctx.ellipse(p.x, p.y, p.size * 1.1, p.size * 0.9, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Head
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.6, p.y - p.size * 0.3, p.size * 0.6, 0, Math.PI * 2);
            ctx.fill();
            
            // Trunk
            ctx.strokeStyle = '#A9A9A9';
            ctx.lineWidth = p.size * 0.25;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(p.x - p.size * 0.9, p.y - p.size * 0.1);
            ctx.quadraticCurveTo(p.x - p.size * 1.3, p.y + p.size * 0.2, p.x - p.size * 1.1, p.y + p.size * 0.6);
            ctx.stroke();
            
            // Ears
            ctx.fillStyle = '#888';
            ctx.beginPath();
            ctx.ellipse(p.x - p.size * 0.8, p.y - p.size * 0.5, p.size * 0.4, p.size * 0.5, -0.3, 0, Math.PI * 2);
            ctx.fill();
            
            // Eye
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.5, p.y - p.size * 0.4, p.size * 0.1, 0, Math.PI * 2);
            ctx.fill();
            
            // Tusk
            ctx.fillStyle = '#FFF';
            ctx.beginPath();
            ctx.moveTo(p.x - p.size * 0.9, p.y);
            ctx.lineTo(p.x - p.size * 1.1, p.y + p.size * 0.2);
            ctx.lineTo(p.x - p.size * 0.85, p.y + p.size * 0.1);
            ctx.closePath();
            ctx.fill();
        }
        
        function drawBear(p) {
            // Body
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.ellipse(p.x, p.y, p.size * 1.1, p.size * 0.9, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Head
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.5, p.y - p.size * 0.4, p.size * 0.5, 0, Math.PI * 2);
            ctx.fill();
            
            // Ears
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.7, p.y - p.size * 0.8, p.size * 0.2, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.3, p.y - p.size * 0.8, p.size * 0.2, 0, Math.PI * 2);
            ctx.fill();
            
            // Snout
            ctx.fillStyle = '#D2691E';
            ctx.beginPath();
            ctx.ellipse(p.x - p.size * 0.5, p.y - p.size * 0.2, p.size * 0.25, p.size * 0.2, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Nose
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.5, p.y - p.size * 0.25, p.size * 0.08, 0, Math.PI * 2);
            ctx.fill();
            
            // Eyes
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.6, p.y - p.size * 0.45, p.size * 0.08, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.4, p.y - p.size * 0.45, p.size * 0.08, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawLion(p) {
            // Mane
            ctx.fillStyle = '#CD853F';
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.5, p.y - p.size * 0.4, p.size * 0.65, 0, Math.PI * 2);
            ctx.fill();
            
            // Body
            ctx.fillStyle = '#DAA520';
            ctx.beginPath();
            ctx.ellipse(p.x, p.y, p.size * 1.1, p.size * 0.9, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Head
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.5, p.y - p.size * 0.4, p.size * 0.45, 0, Math.PI * 2);
            ctx.fill();
            
            // Ears
            ctx.beginPath();
            ctx.moveTo(p.x - p.size * 0.75, p.y - p.size * 0.7);
            ctx.lineTo(p.x - p.size * 0.85, p.y - p.size * 0.9);
            ctx.lineTo(p.x - p.size * 0.65, p.y - p.size * 0.8);
            ctx.closePath();
            ctx.fill();
            
            ctx.beginPath();
            ctx.moveTo(p.x - p.size * 0.25, p.y - p.size * 0.7);
            ctx.lineTo(p.x - p.size * 0.15, p.y - p.size * 0.9);
            ctx.lineTo(p.x - p.size * 0.35, p.y - p.size * 0.8);
            ctx.closePath();
            ctx.fill();
            
            // Snout
            ctx.fillStyle = '#F4A460';
            ctx.beginPath();
            ctx.ellipse(p.x - p.size * 0.5, p.y - p.size * 0.25, p.size * 0.2, p.size * 0.15, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Nose
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.5, p.y - p.size * 0.3, p.size * 0.06, 0, Math.PI * 2);
            ctx.fill();
            
            // Eyes
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.6, p.y - p.size * 0.45, p.size * 0.08, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.4, p.y - p.size * 0.45, p.size * 0.08, 0, Math.PI * 2);
            ctx.fill();
            
            // Tail
            ctx.strokeStyle = '#DAA520';
            ctx.lineWidth = p.size * 0.15;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(p.x + p.size * 1.1, p.y);
            ctx.lineTo(p.x + p.size * 1.5, p.y - p.size * 0.3);
            ctx.stroke();
            
            // Tail tuft
            ctx.fillStyle = '#CD853F';
            ctx.beginPath();
            ctx.arc(p.x + p.size * 1.5, p.y - p.size * 0.3, p.size * 0.15, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawPanda(p) {
            // Body
            ctx.fillStyle = '#FFF';
            ctx.beginPath();
            ctx.ellipse(p.x, p.y, p.size * 1.1, p.size * 0.9, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Head
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.5, p.y - p.size * 0.4, p.size * 0.5, 0, Math.PI * 2);
            ctx.fill();
            
            // Black ears
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.7, p.y - p.size * 0.8, p.size * 0.2, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.3, p.y - p.size * 0.8, p.size * 0.2, 0, Math.PI * 2);
            ctx.fill();
            
            // Black eye patches
            ctx.beginPath();
            ctx.ellipse(p.x - p.size * 0.65, p.y - p.size * 0.45, p.size * 0.15, p.size * 0.2, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.ellipse(p.x - p.size * 0.35, p.y - p.size * 0.45, p.size * 0.15, p.size * 0.2, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // White eyes
            ctx.fillStyle = '#FFF';
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.6, p.y - p.size * 0.45, p.size * 0.08, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.4, p.y - p.size * 0.45, p.size * 0.08, 0, Math.PI * 2);
            ctx.fill();
            
            // Black pupils
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.6, p.y - p.size * 0.45, p.size * 0.04, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.4, p.y - p.size * 0.45, p.size * 0.04, 0, Math.PI * 2);
            ctx.fill();
            
            // Nose
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.5, p.y - p.size * 0.25, p.size * 0.06, 0, Math.PI * 2);
            ctx.fill();
            
            // Black arms
            ctx.beginPath();
            ctx.arc(p.x - p.size * 0.3, p.y + p.size * 0.3, p.size * 0.3, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(p.x + p.size * 0.3, p.y + p.size * 0.3, p.size * 0.3, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // Draw platform
        function drawPlatform() {
            const platformHeight = 80;
            const platformY = game.platformY;
            
            // Grass
            ctx.fillStyle = '#228B22';
            ctx.fillRect(0, platformY, canvas.width, 10);
            
            // Dirt
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(0, platformY + 10, canvas.width, platformHeight - 10);
            
            // Grass blades
            ctx.strokeStyle = '#32CD32';
            ctx.lineWidth = 2;
            for (let i = 0; i < canvas.width; i += 15) {
                ctx.beginPath();
                ctx.moveTo(i, platformY);
                ctx.lineTo(i - 3, platformY - 8);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(i + 5, platformY);
                ctx.lineTo(i + 8, platformY - 6);
                ctx.stroke();
            }
        }
        
        // Update game
        function update() {
            if (game.isGameOver) return;
            
            // Update timer
            game.timer -= 1/60; // Decrease by 1/60 second per frame (60 FPS)
            
            // Check if timer ran out
            if (game.timer <= 0) {
                gameOver();
                return;
            }
            
            // Update timer display
            document.getElementById('timer').textContent = `Time until Game Over: ${game.timer.toFixed(1)}s`;
            
            // Change timer color based on urgency
            const timerElement = document.getElementById('timer');
            if (game.timer < 5) {
                timerElement.style.color = '#d32f2f';
            } else if (game.timer < 8) {
                timerElement.style.color = '#ff9800';
            } else {
                timerElement.style.color = '#4CAF50';
            }
            
            // Move player
            if (game.keys['ArrowLeft'] && game.player.x > game.player.size) {
                game.player.x -= game.player.speed;
            }
            if (game.keys['ArrowRight'] && game.player.x < canvas.width - game.player.size) {
                game.player.x += game.player.speed;
            }
            
            // Spawn cherries
            game.cherrySpawnTimer++;
            if (game.cherrySpawnTimer >= game.cherrySpawnInterval) {
                game.cherries.push(new Cherry());
                game.cherrySpawnTimer = 0;
            }
            
            // Update cherries
            for (let i = game.cherries.length - 1; i >= 0; i--) {
                game.cherries[i].update();
                
                // Check collision with player
                if (game.cherries[i].collidesWith(game.player)) {
                    game.score++;
                    game.cherriesSinceReset++;
                    game.player.scale = 1.0 + (game.score * 0.1);
                    game.player.size = game.player.baseSize * game.player.scale;
                    game.player.y = game.platformY - game.player.size;
                    game.cherries.splice(i, 1);
                    
                    // Update highest size reached
                    if (game.player.scale > game.highestSizeReached) {
                        game.highestSizeReached = game.player.scale;
                    }
                    
                    // Check if 5 cherries collected - reset timer
                    if (game.cherriesSinceReset >= 5) {
                        game.timer = 12.0;
                        game.cherriesSinceReset = 0;
                    }
                    
                    // Check for animal unlocks at each 10x milestone
                    checkAndUnlockAnimals();
                    
                    updateScore();
                    continue;
                }
                
                // Remove off-screen cherries
                if (game.cherries[i].isOffScreen()) {
                    game.cherries.splice(i, 1);
                }
            }
        }
        
        // Check and unlock animals based on highest size reached
        function checkAndUnlockAnimals() {
            const unlockThresholds = {
                10.0: 'elephant',
                20.0: 'bear',
                30.0: 'lion',
                40.0: 'panda'
            };
            
            let newUnlock = false;
            for (const [threshold, animal] of Object.entries(unlockThresholds)) {
                const thresholdNum = parseFloat(threshold);
                if (game.highestSizeReached >= thresholdNum && !game.unlockedAnimals.includes(animal)) {
                    game.unlockedAnimals.push(animal);
                    newUnlock = true;
                }
            }
            
            if (newUnlock) {
                updateAnimalButtons();
                // Show animal selector if it's not already visible
                if (game.unlockedAnimals.length > 1) {
                    document.getElementById('animalSelector').style.display = 'block';
                }
            }
            
            // Update next unlock size
            updateNextUnlockSize();
        }
        
        // Update which animal will unlock next
        function updateNextUnlockSize() {
            const unlockThresholds = [10.0, 20.0, 30.0, 40.0];
            game.nextUnlockSize = null;
            
            for (const threshold of unlockThresholds) {
                if (game.highestSizeReached < threshold) {
                    game.nextUnlockSize = threshold;
                    break;
                }
            }
        }
        
        // Draw game
        function draw() {
            // Clear canvas (sky is in CSS background)
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw platform
            drawPlatform();
            
            // Draw cherries
            game.cherries.forEach(cherry => cherry.draw());
            
            // Draw player
            drawPlayer();
        }
        
        // Update score display
        function updateScore() {
            let scoreText = `Cherries: ${game.score} | Size: ${game.player.scale.toFixed(1)}x`;
            if (game.nextUnlockSize) {
                scoreText += ` | Next Unlock: ${game.nextUnlockSize.toFixed(1)}x`;
            } else {
                scoreText += ` | All Animals Unlocked!`;
            }
            document.getElementById('score').textContent = scoreText;
        }
        
        // Game over
        function gameOver() {
            game.isGameOver = true;
            document.getElementById('finalScore').textContent = 
                `You collected ${game.score} cherries and reached ${game.player.scale.toFixed(1)}x size!`;
            document.getElementById('gameOver').style.display = 'block';
        }
        
        // Restart game
        function restartGame() {
            // Keep unlocked animals and highest size reached
            const unlockedAnimals = [...game.unlockedAnimals];
            const highestSizeReached = game.highestSizeReached;
            
            // Reset game state
            game.score = 0;
            game.cherries = [];
            game.player.x = 400;
            game.player.y = 490;
            game.player.size = 30;
            game.player.scale = 1.0;
            game.timer = 12.0;
            game.cherriesSinceReset = 0;
            game.isGameOver = false;
            game.unlockedAnimals = unlockedAnimals;
            game.highestSizeReached = highestSizeReached;
            
            updateNextUnlockSize();
            updateScore();
            document.getElementById('gameOver').style.display = 'none';
        }
        
        // Update animal buttons to show unlocked/locked status
        function updateAnimalButtons() {
            const buttons = document.querySelectorAll('.animalButton');
            const unlockThresholds = {
                'whale': 0,
                'elephant': 10.0,
                'bear': 20.0,
                'lion': 30.0,
                'panda': 40.0
            };
            
            buttons.forEach(button => {
                const animal = button.getAttribute('data-animal');
                const emoji = button.textContent.split(' ')[0];
                const animalName = animal.charAt(0).toUpperCase() + animal.slice(1);
                
                if (game.unlockedAnimals.includes(animal)) {
                    button.classList.remove('locked');
                    button.disabled = false;
                    button.textContent = `${emoji} ${animalName}`;
                } else {
                    button.classList.add('locked');
                    button.disabled = true;
                    const threshold = unlockThresholds[animal];
                    button.textContent = `${emoji} ${animalName} (Unlock at ${threshold.toFixed(1)}x)`;
                }
            });
        }
        
        // Animal selection - restarts game when you choose a different animal
        document.addEventListener('DOMContentLoaded', () => {
            const buttons = document.querySelectorAll('.animalButton');
            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    const animal = button.getAttribute('data-animal');
                    if (game.unlockedAnimals.includes(animal) && animal !== game.currentAnimal) {
                        // Change animal
                        game.currentAnimal = animal;
                        
                        // Update selected button
                        buttons.forEach(b => b.classList.remove('selected'));
                        button.classList.add('selected');
                        
                        // Restart game at size 1.0
                        const unlockedAnimals = [...game.unlockedAnimals];
                        const highestSizeReached = game.highestSizeReached;
                        
                        game.score = 0;
                        game.cherries = [];
                        game.player.x = 400;
                        game.player.y = 490;
                        game.player.size = 30;
                        game.player.scale = 1.0;
                        game.timer = 12.0;
                        game.cherriesSinceReset = 0;
                        game.isGameOver = false;
                        game.unlockedAnimals = unlockedAnimals;
                        game.highestSizeReached = highestSizeReached;
                        
                        updateNextUnlockSize();
                        updateScore();
                        document.getElementById('gameOver').style.display = 'none';
                    }
                });
            });
            
            // Initialize animal buttons on load
            updateAnimalButtons();
        });
        
        // Game loop
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // Keyboard controls
        window.addEventListener('keydown', (e) => {
            game.keys[e.key] = true;
        });
        
        window.addEventListener('keyup', (e) => {
            game.keys[e.key] = false;
        });
        
        // Touch controls for iPad/mobile
        let touchStartX = null;
        let touchCurrentX = null;
        let isTouching = false;
        
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            touchStartX = touch.clientX;
            touchCurrentX = touch.clientX;
            isTouching = true;
        });
        
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (!isTouching) return;
            
            const touch = e.touches[0];
            touchCurrentX = touch.clientX;
            
            // Calculate movement direction
            const deltaX = touchCurrentX - touchStartX;
            
            if (deltaX < -10) {
                // Swipe left
                game.keys['ArrowLeft'] = true;
                game.keys['ArrowRight'] = false;
            } else if (deltaX > 10) {
                // Swipe right
                game.keys['ArrowRight'] = true;
                game.keys['ArrowLeft'] = false;
            } else {
                game.keys['ArrowLeft'] = false;
                game.keys['ArrowRight'] = false;
            }
        });
        
        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            isTouching = false;
            touchStartX = null;
            touchCurrentX = null;
            game.keys['ArrowLeft'] = false;
            game.keys['ArrowRight'] = false;
        });
        
        canvas.addEventListener('touchcancel', (e) => {
            e.preventDefault();
            isTouching = false;
            touchStartX = null;
            touchCurrentX = null;
            game.keys['ArrowLeft'] = false;
            game.keys['ArrowRight'] = false;
        });
        
        // Start game
        gameLoop();
    </script>
</body>
</html>
